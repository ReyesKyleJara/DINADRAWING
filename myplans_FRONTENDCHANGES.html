<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Plans | DiNaDrawing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fffaf2;
    }
  </style>
</head>
<body class="flex bg-[#fffaf2]">

<!-- SIDEBAR -->
<aside id="sidebar"
class="fixed top-4 left-0 h-[calc(100vh-1rem)] w-64
       bg-[#f4b41a] rounded-tr-3xl
       p-6 shadow
       hidden md:flex md:flex-col md:gap-6">

  <!-- HEADER -->
  <div class="flex items-center gap-2">
    <img src="Assets/dinadrawing-logo.png" alt="Logo" class="w-14">
    <h2 class="text-xl font-bold text-[#222]">DiNaDrawing</h2>
  </div>

  <!-- NAVIGATIONS -->
  <nav>
    <ul class="space-y-5">
      <li><a href="dashboard.html" class="block px-4 py-2 rounded-lg font-medium text-[#222] hover:bg-[#222] hover:text-white transition">Home</a></li>
      <li><a href="myplans.html" class="block px-4 py-2 rounded-lg font-medium bg-[#222] text-white hover:bg-[#111] transition">My Plans</a></li>
      <li><a href="help.html" class="block px-4 py-2 rounded-lg font-medium text-[#222] hover:bg-[#222] hover:text-white transition">Help</a></li>
      <li><a href="settings.html" class="block px-4 py-2 rounded-lg font-medium text-[#222] hover:bg-[#222] hover:text-white transition">Settings</a></li>
    </ul>
  </nav>
</aside>

  <!-- MAIN CONTENT -->
  <main class="ml-0 md:ml-64 flex-1 min-h-screen px-12 py-10 pt-28">

<!-- PAGE TITLE (STICKY HEADER) -->
<div class="flex justify-between items-center border-b-2 border-gray-200 pb-4 mb-6 fixed top-0 md:left-64 left-0 w-[calc(100%-0rem)] md:w-[calc(100%-16rem)] bg-[#fffaf2] z-40 px-12 py-10">

  <div class="flex flex-col">
    <h1 class="text-3xl font-bold">My Plans</h1>
    <span class="text-gray-600 text-sm">Manage, view, and edit your plans easily. </span>
  </div>

  <div class="flex items-center gap-3">

        <!-- CREATE EVENT -->
    <button id="openCreateEvent"
      class="border border-[#222] bg-white px-4 py-2 rounded-2xl font-medium hover:bg-[#222] hover:text-white transition">
      <span class="hidden md:inline">+ Create Event</span>
      <span class="md:hidden">Create</span>
    </button>

    <!-- JOIN EVENT -->
    <button id="openJoinEvent"
      class="border border-[#222] bg-white px-4 py-2 rounded-2xl font-medium hover:bg-[#222] hover:text-white transition">
      <span class="hidden md:inline">Join Event</span>
      <span class="md:hidden">Join</span>
    </button>

    <!-- TOPBAR RIGHT -->
    <div class="flex items-center gap-4 relative">

  <!-- CREATE EVENT MODAL -->
<div id="createEventModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center hidden z-50 p-4">
  <div class="bg-white rounded-2xl shadow-xl relative w-full max-w-md max-h-[90vh] overflow-y-auto p-6">
    <button id="closeCreateEvent" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl">
      &times;
    </button>

    <!-- HEADER -->
    <h2 class="text-2xl font-bold mb-1">Create Event</h2>
    <p class="text-sm text-gray-500 mb-4">
      Fill in the details to start planning your event.
    </p>

    <!-- EVENT NAME -->
    <label class="block text-sm font-medium mb-1">Event Name <span class="text-gray-400 text-xs">(required)</span> </label>
    <input type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-4" placeholder="Enter event name">

    <!-- DESCRIPTION WITH CHARACTER COUNT -->
    <label class="block text-sm font-medium mb-1">Description </label>
    <textarea id="eventDescription" maxlength="200" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-1 resize-none h-20" placeholder="Write a short description..."></textarea>
    <div class="text-right text-xs text-gray-500 mb-4">
      <span id="charCount">0</span>/200
    </div>

    <!-- DATE & TIME SIDE BY SIDE -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium mb-1">Date</label>
        <input type="date" class="w-full border border-gray-300 rounded-lg px-3 py-2">
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Time</label>
        <input type="time" class="w-full border border-gray-300 rounded-lg px-3 py-2">
      </div>
    </div>

    <!-- LOCATION -->
    <label class="block text-sm font-medium mb-1">Location</label>
    <input id="eventLocation" type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-2" placeholder="Search for a location">
    <div id="map" class="w-full h-60 rounded-lg border border-gray-300 mb-4"></div>

    <p class="text-gray-500 text-xs mb-4 text-justify">
     Only Event Name is required. You can leave Description, Date, Time, and Location blank and create a poll for your attendees to vote on these details.
    </p>

    <!-- BUTTONS -->
    <div class="flex justify-end gap-3 mb-2">
      <button id="cancelCreateEvent" class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100 transition">
        Cancel
      </button>
      <button id="saveCreateEvent" class="bg-[#f4b41a] px-4 py-2 rounded-lg font-medium hover:bg-[#e0a419] transition">
        Save & Continue
      </button>
    </div>

  </div>
</div>


<!-- JOIN EVENT MODAL -->
<div id="joinEventModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-2xl p-6 w-[500px] shadow-xl relative">
    <button id="closeJoinEvent" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl">
      &times;
    </button>

    <!-- HEADER -->
    <h2 class="text-2xl font-bold mb-1">Join Event</h2>
    <p class="text-sm text-gray-500 mb-4">
      Enter the event code or link to join.
    </p>

    <!-- INPUT FIELD -->
    <label class="block text-sm font-medium mb-1">Event Code / Link</label>
    <input type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-6" placeholder="Paste code or link here">

    <!-- BUTTONS -->
    <div class="flex justify-end gap-3">
      <button id="cancelJoinEvent" class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100 transition">
        Cancel
      </button>
      <button id="joinJoinEvent" class="bg-[#f4b41a] px-4 py-2 rounded-lg font-medium hover:bg-[#e0a419] transition">
        Join
      </button>
    </div>
  </div>
</div>

       <!-- NOTIFICATIONS -->
      <div>
        <button id="notificationBtn"
          class="relative w-9 h-9 flex items-center justify-center rounded-full bg-white border border-[#222] hover:bg-[#222] hover:text-white transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3c0 .386-.146.735-.395 1.002L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
          <span id="notificationDot"
            class="absolute top-1 right-1 w-2.5 h-2.5 bg-[#f4b41a] rounded-full"></span>
        </button>
      </div>

       <!-- PROFILE -->
  <div class="relative">
    <button id="profileBtn" class="flex items-center gap-2 bg-[#f4b41a]/30 border border-[#222] rounded-full px-3 py-1.5 hover:bg-[#f4b41a]/50 transition">
      <img src="Assets/Profile Icon/profile.png" alt="Profile" class="w-8 h-8 rounded-full border-2 border-[#f4b41a]">
      <span class="font-medium text-[#222] hidden md:inline">Venice</span>
    </button>

    <!-- PROFILE DROPDOWN -->
    <div id="profileDropdown" class="absolute right-0 mt-2 w-60 bg-white shadow-lg rounded-2xl border border-gray-200 hidden z-50">
    <div class="p-4 border-b border-gray-200 text-center bg-[#fffaf2] rounded-t-2xl">
        <img src="Assets/Profile Icon/profile.png" alt="Profile" class="w-12 h-12 mx-auto rounded-full border-2 border-[#f4b41a] mb-2 shadow">
        <h2 class="text-sm font-semibold text-[#222]">Venice</h2>
      </div>
      <div class="py-2">
        <a href="help.html" class="block px-4 py-2 text-sm hover:bg-gray-50">Help</a>
        <a href="aboutus.html" class="block px-4 py-2 text-sm hover:bg-gray-50">About Us</a>
        <a href="settings.html" class="block px-4 py-2 text-sm hover:bg-gray-50">Settings</a>
        <button id="logoutProfile" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">Log out</button>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION DROPDOWN -->
  <div id="notificationPanel"
       class="absolute top-full right-0 mt-2 w-[90vw] md:w-60 lg:w-80 max-w-[28rem]
              bg-white shadow-lg rounded-2xl border border-gray-200 hidden z-50">
    <div class="p-4 border-b border-gray-200 flex justify-between items-center">
      <h4 class="font-semibold">Notifications</h4>
      <a href="#" id="clearNotificationsTop" class="text-sm text-[#2563eb] hover:underline">Mark all as read</a>
    </div>
    <ul id="notificationList" class="p-4 space-y-3 max-h-64 overflow-y-auto">
      <li class="flex items-start gap-3 bg-white hover:bg-gray-50 p-2 rounded-lg cursor-pointer">
        <img src="Assets/Profile Icon/profile2.png" onerror="this.src='Assets/profile2.png'" alt="User" class="w-10 h-10 rounded-full border border-gray-200">
        <p class="text-sm"><strong>Kyle</strong> added 'Rice' to Assigned Tasks in <strong>Family Reunion.</strong></p>
      </li>
      <li class="flex items-start gap-3 bg-white hover:bg-gray-50 p-2 rounded-lg cursor-pointer">
        <img src="Assets/Profile Icon/profile4.png" alt="User" class="w-10 h-10 rounded-full border border-gray-200">
        <p class="text-sm"><strong>Ken</strong> voted for <strong>Oct 16</strong> as the final date for <strong>Birthday Trip.</strong></p>
      </li>
      <li class="flex items-start gap-3 bg-white hover:bg-gray-50 p-2 rounded-lg cursor-pointer">
        <img src="Assets/Profile Icon/profile3.png" alt="User" class="w-10 h-10 rounded-full border border-gray-200">
        <p class="text-sm"><strong>Andrea</strong> added 'Japan' to Poll in <strong>Birthday Trip.</strong></p>
      </li>
    </ul>
    <div class="border-t border-gray-200 p-3 text-center">
      <a href="#" id="clearNotificationsBottom" class="text-sm text-[#2563eb] hover:underline">Clear All Notifications</a>
    </div>
  </div>
</div>
  </div>
</div>

    <!-- WHITE CARD WRAPPER FOR PLANS (matches dashboard style) -->
    <div class="bg-white rounded-2xl shadow border border-gray-200 p-6 mt-6">

      <!-- Card header: title on the left, view toggle (icons) on the right -->
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-lg font-semibold">Your Upcoming Plans &gt;</h2>
        </div>
        <div class="flex gap-2">
          <button id="galleryViewBtn" title="Gallery view" class="p-2 rounded-md bg-[#f4b41a] text-[#222] hover:bg-[#e0a419] transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M3 3h4v4H3V3zM3 9h4v4H3V9zM9 3h4v4H9V3zM9 9h4v4H9V9zM15 3h2v2h-2V3zM15 7h2v2h-2V7zM15 11h2v2h-2v-2z" />
            </svg>
          </button>

          <button id="listViewBtn" title="List view" class="p-2 rounded-md text-gray-600 hover:bg-gray-100 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4 5h12v2H4V5zm0 4h12v2H4V9zm0 4h12v2H4v-2z" clip-rule="evenodd" />
            </svg>
          </button>

          <div class="relative">
            <button id="headerMoreBtn" title="More actions" aria-label="More actions" class="p-2 rounded-md text-gray-600 hover:bg-gray-100 transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </button>

            <!-- Header more menu (appears below the three dots) -->
            <div id="headerMoreMenu" class="hidden fixed right-0 mt-2 w-44 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
              <button id="headerMenuArchive" class="w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-50 text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-700" viewBox="0 0 20 20" fill="currentColor"><path d="M4 3a1 1 0 00-1 1v2a1 1 0 001 1h12a1 1 0 001-1V4a1 1 0 00-1-1H4zm0 8v4a2 2 0 002 2h8a2 2 0 002-2v-4H4z"/></svg>
                <span>Archived Plans</span>
              </button>
              <button id="headerMenuTrash" class="w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-50 text-sm text-red-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-red-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H3a1 1 0 100 2h1v9a2 2 0 002 2h6a2 2 0 002-2V6h1a1 1 0 100-2h-2V3a1 1 0 00-1-1H6zm2 4a1 1 0 011 1v7a1 1 0 11-2 0V7a1 1 0 011-1zm4 0a1 1 0 011 1v7a1 1 0 11-2 0V7a1 1 0 011-1z" clip-rule="evenodd"/></svg>
                <span>Deleted Plans</span>
              </button>
            </div>
          </div>
        </div>
      </div>

    <!-- YOUR UPCOMING PLANS -->
<section class="mb-10">
  

  <!-- GALLERY VIEW -->
  <div id="galleryView" class="flex flex-wrap gap-6">

    <!-- UPCOMING PLAN 1 -->
    <div class="relative w-64 bg-white border border-gray-300 rounded-2xl overflow-hidden shadow group">
      <div class="bg-[#f4b41a] text-[#222] font-bold p-4 text-lg flex justify-between items-start">
        <div>
          Birthday Trip
          <div class="text-sm font-normal text-[#222]/80">Japan</div>
        </div>

        <!-- MENU (DELETE PLAN & DOWNLOAD PDF) -->
        <div class="relative">
          <button onclick="showPlanActions(event,this)" class="text-[#222] hover:text-gray-700 px-2 py-1 rounded-lg hover:bg-[#f5c94a]/30 transition">⋮</button>
        </div>
      </div>

      <div class="flex items-center justify-between p-4">
        <div class="text-center">
          <div class="text-xs text-gray-700">Oct</div>
          <div class="text-2xl font-bold text-[#222]">16</div>
        </div>
        <button class="bg-[#222] text-white text-sm px-4 py-1.5 rounded-lg hover:bg-[#444] transition">
          View
        </button>
      </div>
    </div>

    <!-- UPCOMING PLAN 2 -->
    <div class="relative w-64 bg-white border border-gray-300 rounded-2xl overflow-hidden shadow group">
      <div class="bg-green-600 text-[#222] font-bold p-4 text-lg flex justify-between items-start">
        <div>
          Family Reunion
          <div class="text-sm font-normal text-[#222]/80">Davao City</div>
        </div>

        <!-- MENU (DELETE PLAN & DOWNLOAD PDF) -->
        <div class="relative">
          <button onclick="showPlanActions(event,this)" class="text-[#222] hover:text-gray-700 px-2 py-1 rounded-lg hover:bg-green-500/30 transition">⋮</button>
        </div>
      </div>

      <div class="flex items-center justify-between p-4">
        <div class="text-center">
          <div class="text-xs text-gray-700">Oct</div>
          <div class="text-2xl font-bold text-[#222]">18</div>
        </div>
        <button class="bg-[#222] text-white text-sm px-4 py-1.5 rounded-lg hover:bg-[#444] transition">
          View
        </button>
      </div>
    </div>

  </div>

  <!-- LIST VIEW -->
  <div id="listView" class="hidden">
    <div class="bg-white rounded-2xl shadow border border-gray-200 overflow-hidden">
      <table class="w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700">Plan Name</th>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700">Location</th>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700">Date</th>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <tr class="hover:bg-gray-50 transition">
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-[#f4b41a] rounded-lg flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#222]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <span class="font-medium text-[#222]">Birthday Trip</span>
              </div>
            </td>
            <td class="px-6 py-4 text-gray-600">Japan</td>
            <td class="px-6 py-4 text-gray-600">Oct 16, 2025</td>
            <td class="px-6 py-4">
              <div class="flex gap-2">
                <button class="bg-[#222] text-white text-sm px-4 py-1.5 rounded-lg hover:bg-[#444] transition">View</button>
                <div class="relative">
                  <button onclick="showPlanActions(event,this)" class="text-gray-600 hover:text-[#222] px-2 py-1 rounded-lg hover:bg-gray-100 transition">⋮</button>
                </div>
              </div>
            </td>
          </tr>
          <tr class="hover:bg-gray-50 transition">
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <span class="font-medium text-[#222]">Family Reunion</span>
              </div>
            </td>
            <td class="px-6 py-4 text-gray-600">Davao City</td>
            <td class="px-6 py-4 text-gray-600">Oct 18, 2025</td>
            <td class="px-6 py-4">
              <div class="flex gap-2">
                <button class="bg-[#222] text-white text-sm px-4 py-1.5 rounded-lg hover:bg-[#444] transition">View</button>
                <div class="relative">
                  <button onclick="showPlanActions(event,this)" class="text-gray-600 hover:text-[#222] px-2 py-1 rounded-lg hover:bg-gray-100 transition">⋮</button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- YOUR ONGOING PLANS -->
<section>
  <h2 class="text-lg font-semibold mb-4">Your Ongoing Plans &gt;</h2>

  <!-- GALLERY VIEW -->
  <div id="galleryView2" class="flex flex-wrap gap-6">
    
    <!-- ONGOING PLAN 1 -->
    <div class="relative w-64 bg-white border border-gray-300 rounded-2xl overflow-hidden shadow group">

      <div class="bg-blue-500 text-[#222] font-bold p-4 text-lg flex justify-between items-start">
        <div>
          Dagat naaa!
          <div class="text-sm font-normal text-[#222]/80">-</div>
        </div>

        <!-- MENU (DELETE PLAN & DOWNLOAD PDF) -->
        <div class="relative">
          <button onclick="showPlanActions(event,this)" class="text-[#222] hover:text-gray-700 px-2 py-1 rounded-lg hover:bg-blue-400/30 transition">⋮</button>
        </div>
      </div>

      <div class="flex items-center justify-between p-4">
        <div class="text-center">
          <div class="text-xs text-gray-700">-</div>
          <div class="text-2xl font-bold text-[#222]">-</div>
        </div>
        <button onclick="window.location.href='plan_feed.html'" 
          class="bg-[#222] text-white text-sm px-4 py-1.5 rounded-lg hover:bg-[#444] transition">
          View
        </button>
      </div>
    </div>

  <!-- LIST VIEW -->
  <div id="listView2" class="hidden">
    <div class="bg-white rounded-2xl shadow border border-gray-200 overflow-hidden">
      <table class="w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700">Plan Name</th>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700">Location</th>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700">Date</th>
            <th class="text-left px-6 py-3 text-sm font-medium text-gray-700"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <tr class="hover:bg-gray-50 transition">
            <td class="px-6 py-4">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <span class="font-medium text-[#222]">Dagat naaa!</span>
              </div>
            </td>
            <td class="px-6 py-4 text-gray-600">-</td>
            <td class="px-6 py-4 text-gray-600">-</td>
            <td class="px-6 py-4">
              <div class="flex gap-2">
                <button onclick="window.location.href='plan_feed.html'" class="bg-[#222] text-white text-sm px-4 py-1.5 rounded-lg hover:bg-[#444] transition">View</button>
                <div class="relative">
                  <button onclick="showPlanActions(event,this)" class="text-gray-600 hover:text-[#222] px-2 py-1 rounded-lg hover:bg-gray-100 transition">⋮</button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

  </div>

<!-- SCRIPTS -->

<!-- GLOBAL PLAN ACTIONS MODAL (appears to the right of a plan card) -->
<div id="planActionModal" class="hidden fixed z-50">
  <div id="planActionInner" class="bg-white border border-gray-200 rounded-lg shadow-lg text-sm w-44 py-2">
    <button id="actionArchiveBtn" class="flex items-center gap-2 w-full text-left px-4 py-2 hover:bg-gray-100 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
        <path d="M4 3a1 1 0 00-1 1v2a1 1 0 001 1h12a1 1 0 001-1V4a1 1 0 00-1-1H4zm0 8v4a2 2 0 002 2h8a2 2 0 002-2v-4H4z" />
      </svg>
      <span>Archive Plan</span>
    </button>
    <button id="actionDownloadBtn" class="flex items-center gap-2 w-full text-left px-4 py-2 hover:bg-gray-100 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path d="M9 3a1 1 0 012 0v8.586l1.293-1.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 011.414-1.414L9 11.586V3z" />
        <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" />
      </svg>
      <span>Download PDF</span>
    </button>
    <button id="actionDeleteBtn" class="flex items-center gap-2 w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-red-600" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H3a1 1 0 100 2h1v9a2 2 0 002 2h6a2 2 0 002-2V6h1a1 1 0 100-2h-2V3a1 1 0 00-1-1H6zm2 4a1 1 0 011 1v7a1 1 0 11-2 0V7a1 1 0 011-1zm4 0a1 1 0 011 1v7a1 1 0 11-2 0V7a1 1 0 011-1z" clip-rule="evenodd" />
      </svg>
      <span>Delete Plan</span>
    </button>
  </div>
</div>

<!-- ARCHIVE LIST PANEL (opened from header) -->
<div id="archiveListPanel" class="hidden fixed z-50">
  <div class="bg-white shadow-lg rounded-2xl border border-gray-200 w-80 p-3">
    <div class="flex items-center justify-between pb-2 border-b border-gray-100 mb-2">
      <h4 class="font-semibold">Archived Plans</h4>
      <button id="closeArchivePanel" class="text-sm text-gray-500 hover:text-gray-700">Close</button>
    </div>
    <ul id="archiveList" class="space-y-2 max-h-48 overflow-y-auto text-sm text-gray-700">
      <li class="text-gray-500">No archived plans</li>
    </ul>
  </div>
</div>

<!-- TRASH / DELETED PLANS PANEL (opened from header) -->
<div id="trashListPanel" class="hidden fixed z-50">
  <div class="bg-white shadow-lg rounded-2xl border border-gray-200 w-80 p-3">
    <div class="flex items-center justify-between pb-2 border-b border-gray-100 mb-2">
      <h4 class="font-semibold">Deleted Plans</h4>
      <button id="closeTrashPanel" class="text-sm text-gray-500 hover:text-gray-700">Close</button>
    </div>
    <ul id="trashList" class="space-y-2 max-h-48 overflow-y-auto text-sm text-gray-700">
      <li class="text-gray-500">No deleted plans</li>
    </ul>
  </div>
</div>

<!-- GENERIC CONFIRM POPOVER (reused for delete / archive confirmations) -->
<div id="actionConfirmModal" class="hidden fixed z-50">
  <div class="bg-white border border-gray-200 rounded-lg shadow-lg text-sm w-64 p-4">
    <p id="actionConfirmMessage" class="text-sm text-gray-700 mb-3">Are you sure?</p>

    <div id="actionConfirmInputWrap" class="mb-3 hidden">
      <label class="flex items-start gap-2">
          <input id="actionConfirmCheckbox" type="checkbox" class="w-4 h-4 mt-0.5" />
          <span id="actionConfirmCheckboxLabel" class="text-sm text-gray-600 leading-4">I understand deleting this plan is permanent</span>
      </label>
    </div>

    <div class="flex justify-end gap-2">
      <button id="actionConfirmCancel" class="px-3 py-1 rounded-lg border border-gray-300 hover:bg-gray-100">Cancel</button>
      <button id="actionConfirmOk" disabled class="px-3 py-1 rounded-lg bg-[#f4b41a] hover:bg-[#e0a419] disabled:opacity-60">Confirm</button>
    </div>
  </div>
</div>

<!-- Add jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  // UNIFIED VIEW TOGGLE (CONTROLS BOTH SECTIONS)
  const galleryViewBtn = document.getElementById("galleryViewBtn");
  const listViewBtn = document.getElementById("listViewBtn");
  const galleryView = document.getElementById("galleryView");
  const listView = document.getElementById("listView");
  const galleryView2 = document.getElementById("galleryView2");
  const listView2 = document.getElementById("listView2");

  galleryViewBtn.addEventListener("click", () => {
    // Show gallery view for both sections
    galleryView.classList.remove("hidden");
    listView.classList.add("hidden");
    galleryView2.classList.remove("hidden");
    listView2.classList.add("hidden");
    
    // Update button styles
    galleryViewBtn.classList.add("bg-[#f4b41a]", "text-[#222]");
    galleryViewBtn.classList.remove("text-gray-600");
    listViewBtn.classList.remove("bg-[#f4b41a]", "text-[#222]");
    listViewBtn.classList.add("text-gray-600");
  });

  listViewBtn.addEventListener("click", () => {
    // Show list view for both sections
    galleryView.classList.add("hidden");
    listView.classList.remove("hidden");
    galleryView2.classList.add("hidden");
    listView2.classList.remove("hidden");
    
    // Update button styles
    listViewBtn.classList.add("bg-[#f4b41a]", "text-[#222]");
    listViewBtn.classList.remove("text-gray-600");
    galleryViewBtn.classList.remove("bg-[#f4b41a]", "text-[#222]");
    galleryViewBtn.classList.add("text-gray-600");
  });

  // Header quick-action (three dots) and menu
  const headerMoreBtn = document.getElementById('headerMoreBtn');
  const headerMoreMenu = document.getElementById('headerMoreMenu');
  const headerMenuArchive = document.getElementById('headerMenuArchive');
  const headerMenuTrash = document.getElementById('headerMenuTrash');
  const archivePanel = document.getElementById('archiveListPanel');
  const trashPanel = document.getElementById('trashListPanel');
  const closeArchive = document.getElementById('closeArchivePanel');
  const closeTrash = document.getElementById('closeTrashPanel');

  function openPanelNearButton(panel, btn) {
    if (!panel || !btn) return;
    // deactivate the header more button first
    if (headerMoreBtn) {
      headerMoreBtn.classList.remove('bg-[#f4b41a]', 'text-[#222]');
      const s = headerMoreBtn.querySelector('svg');
      if (s) {
        s.classList.remove('text-[#222]', 'text-red-600');
        s.classList.add('text-gray-600');
      }
    }

    // hide the other panel
    if (panel === archivePanel) trashPanel?.classList.add('hidden');
    if (panel === trashPanel) archivePanel?.classList.add('hidden');

    // Temporarily make visible to measure size
    panel.style.visibility = 'hidden';
    panel.classList.remove('hidden');
    const mRect = panel.getBoundingClientRect();
    const btnRect = btn.getBoundingClientRect();

    // Prefer below the button, clamp to viewport
    const gap = 8;
    let left = btnRect.left + window.scrollX;
    if (left + mRect.width + 8 > window.innerWidth + window.scrollX) {
      left = Math.max(8 + window.scrollX, window.innerWidth + window.scrollX - mRect.width - 8);
    }
    let top = btnRect.bottom + window.scrollY + gap;
    if (top + mRect.height + 8 > window.scrollY + window.innerHeight) {
      top = Math.max(8 + window.scrollY, btnRect.top + window.scrollY - mRect.height - gap);
    }

    panel.style.left = left + 'px';
    panel.style.top = top + 'px';
    panel.style.visibility = 'visible';

    // Mark the clicked header button active (yellow)
    btn.classList.add('bg-[#f4b41a]', 'text-[#222]');
    const svg = btn.querySelector('svg');
    if (svg) {
      svg.classList.remove('text-gray-600', 'text-red-600');
      svg.classList.add('text-[#222]');
    }
  }

  // header more button toggles the small menu
  headerMoreBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    // close panels
    archivePanel?.classList.add('hidden');
    trashPanel?.classList.add('hidden');
    // toggle menu
    if (!headerMoreMenu) return;
    if (headerMoreMenu.classList.contains('hidden')) {
      // position below the button
      headerMoreMenu.classList.remove('hidden');
      headerMoreMenu.style.visibility = 'hidden';
      const mRect = headerMoreMenu.getBoundingClientRect();
      const btnRect = headerMoreBtn.getBoundingClientRect();
      let left = btnRect.right - mRect.width + window.scrollX;
      left = Math.max(8 + window.scrollX, Math.min(left, window.innerWidth + window.scrollX - mRect.width - 8));
      let top = btnRect.bottom + window.scrollY + 6;
      headerMoreMenu.style.left = left + 'px';
      headerMoreMenu.style.top = top + 'px';
      headerMoreMenu.style.visibility = 'visible';
      // mark active
      headerMoreBtn.classList.add('bg-[#f4b41a]', 'text-[#222]');
      headerMoreBtn.querySelector('svg')?.classList.remove('text-gray-600');
      headerMoreBtn.querySelector('svg')?.classList.add('text-[#222]');
    } else {
      headerMoreMenu.classList.add('hidden');
      headerMoreBtn.classList.remove('bg-[#f4b41a]','text-[#222]');
      headerMoreBtn.querySelector('svg')?.classList.remove('text-[#222]');
      headerMoreBtn.querySelector('svg')?.classList.add('text-gray-600');
    }
  });

  // menu items open the panels anchored to the three-dots button
  headerMenuArchive?.addEventListener('click', (e) => {
    e.stopPropagation();
    headerMoreMenu?.classList.add('hidden');
    openPanelNearButton(archivePanel, headerMoreBtn);
  });
  headerMenuTrash?.addEventListener('click', (e) => {
    e.stopPropagation();
    headerMoreMenu?.classList.add('hidden');
    openPanelNearButton(trashPanel, headerMoreBtn);
  });

  closeArchive?.addEventListener('click', (e) => { e.stopPropagation(); archivePanel.classList.add('hidden'); headerMoreBtn?.classList.remove('bg-[#f4b41a]','text-[#222]'); headerMoreBtn?.querySelector('svg')?.classList.remove('text-[#222]'); headerMoreBtn?.querySelector('svg')?.classList.add('text-gray-600'); });
  closeTrash?.addEventListener('click', (e) => { e.stopPropagation(); trashPanel.classList.add('hidden'); headerMoreBtn?.classList.remove('bg-[#f4b41a]','text-[#222]'); headerMoreBtn?.querySelector('svg')?.classList.remove('text-[#222]'); headerMoreBtn?.querySelector('svg')?.classList.add('text-gray-600'); });

  // Close panels when clicking outside
  document.addEventListener('click', (e) => {
    // hide header menu if clicked outside
    if (headerMoreMenu && !headerMoreMenu.contains(e.target) && e.target !== headerMoreBtn) {
      headerMoreMenu.classList.add('hidden');
      headerMoreBtn?.classList.remove('bg-[#f4b41a]','text-[#222]');
      headerMoreBtn?.querySelector('svg')?.classList.remove('text-[#222]');
      headerMoreBtn?.querySelector('svg')?.classList.add('text-gray-600');
    }
    if (archivePanel && !archivePanel.contains(e.target) && e.target !== headerMoreBtn) {
      archivePanel.classList.add('hidden');
      headerMoreBtn?.classList.remove('bg-[#f4b41a]','text-[#222]');
      headerMoreBtn?.querySelector('svg')?.classList.remove('text-[#222]');
      headerMoreBtn?.querySelector('svg')?.classList.add('text-gray-600');
    }
    if (trashPanel && !trashPanel.contains(e.target) && e.target !== headerMoreBtn) {
      trashPanel.classList.add('hidden');
      headerMoreBtn?.classList.remove('bg-[#f4b41a]','text-[#222]');
      headerMoreBtn?.querySelector('svg')?.classList.remove('text-[#222]');
      headerMoreBtn?.querySelector('svg')?.classList.add('text-gray-600');
    }
  });

  // Global context for the plan actions modal
  window.__planActionContext = {};

  function showPlanActions(e, button) {
    e.stopPropagation();
    hidePlanActionModal();
    const modal = document.getElementById('planActionModal');
    const card = button.closest('.group') || button.closest('tr') || button.closest('div');
    if (!card) return;

    // Try to infer a title from the card
    let title = 'Plan';
    const titleEl = card.querySelector('span.font-medium, .font-medium, .text-lg, .font-bold');
    if (titleEl) title = titleEl.textContent.trim();

    window.__planActionContext = { card, title };

    // Anchor to the clicked button so the modal appears closer to the card
    const btnRect = button.getBoundingClientRect();

    // Temporarily show the modal invisibly to measure its size
    modal.style.visibility = 'hidden';
    modal.classList.remove('hidden');
    const mRect = modal.getBoundingClientRect();

    // Calculate preferred left: try to place to the right of the button, but clamp to viewport
    const gap = 6;
    let left = btnRect.right + gap + window.scrollX;
    if (left + mRect.width + 8 > window.innerWidth + window.scrollX) {
      // not enough space on the right; place it slightly overlapping the card (closer)
      left = Math.max(8 + window.scrollX, btnRect.left - mRect.width - gap + window.scrollX);
    }

    // Vertically center the modal near the button
    let top = btnRect.top + window.scrollY + (btnRect.height / 2) - (mRect.height / 2);
    // clamp top to viewport
    top = Math.max(8 + window.scrollY, Math.min(top, window.scrollY + window.innerHeight - mRect.height - 8));

    modal.style.left = left + 'px';
    modal.style.top = top + 'px';
    modal.style.visibility = 'visible';
    // modal is already visible (class removed)
  }

  function hidePlanActionModal() {
    document.getElementById('planActionModal').classList.add('hidden');
    document.getElementById('actionConfirmModal').classList.add('hidden');
  }

  function openActionConfirm(message, onConfirm, options = {}) {
    const confirmModal = document.getElementById('actionConfirmModal');
    const msg = document.getElementById('actionConfirmMessage');
    const inputWrap = document.getElementById('actionConfirmInputWrap');
    const checkbox = document.getElementById('actionConfirmCheckbox');
    const checkboxLabel = document.getElementById('actionConfirmCheckboxLabel');
    const okBtn = document.getElementById('actionConfirmOk');
    const cancelBtn = document.getElementById('actionConfirmCancel');

    msg.textContent = message;

    // Position the confirm modal near the action modal
    const actionModal = document.getElementById('planActionModal');
    const rect = actionModal.getBoundingClientRect();
    confirmModal.style.top = (rect.top + window.scrollY + 46) + 'px';
    confirmModal.style.left = (rect.left + window.scrollX) + 'px';

    // Options handling (no typing required)
    // - { type: 'delete' } -> require checking an "I understand" checkbox (strong wording)
    // - { type: 'archive' } -> require checking an "I understand" checkbox
    let requireCheckbox = false;
    if (options.type === 'delete') {
      requireCheckbox = true;
      inputWrap.classList.remove('hidden');
      checkbox.checked = false;
      checkboxLabel.textContent = `I understand deleting this plan is permanent`;
      okBtn.disabled = true;
      checkbox.focus();
    } else if (options.type === 'archive') {
      requireCheckbox = true;
      inputWrap.classList.remove('hidden');
      checkbox.checked = false;
      checkboxLabel.textContent = `I understand this plan will be archived`;
      okBtn.disabled = true;
      checkbox.focus();
    } else {
      inputWrap.classList.add('hidden');
      okBtn.disabled = false;
    }

    confirmModal.classList.remove('hidden');

    function cleanup() {
      okBtn.removeEventListener('click', okHandler);
      cancelBtn.removeEventListener('click', cancelHandler);
      checkbox.removeEventListener('change', checkboxHandler);
      // keep the confirm modal until explicitly closed by handlers
    }

    function okHandler() {
      cleanup();
      onConfirm && onConfirm();
      confirmModal.classList.add('hidden');
      hidePlanActionModal();
    }

    function cancelHandler() {
      cleanup();
      confirmModal.classList.add('hidden');
      // do NOT re-open action modal automatically
    }

    function checkboxHandler() {
      okBtn.disabled = !checkbox.checked;
    }

    okBtn.addEventListener('click', okHandler);
    cancelBtn.addEventListener('click', cancelHandler);
    if (requireCheckbox) checkbox.addEventListener('change', checkboxHandler);
  }

  function archivePlan() {
    const title = window.__planActionContext.title || 'this plan';
    openActionConfirm('Are you sure?', () => {
      alert(`Archived "${title}"`);
    }, { type: 'archive' });
  }

  function deletePlan() {
    const title = window.__planActionContext.title || 'this plan';
    openActionConfirm('Are you sure?', () => {
      alert(`Deleted "${title}"`);
    }, { type: 'delete' });
  }

  // DOWNLOAD PDF (accepts optional title)
  async function downloadPDF(titleOverride) {
    const title = titleOverride || window.__planActionContext.title || 'Plan';
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'pt', format: 'a4' });

    const pageWidth = doc.internal.pageSize.getWidth();
    const margin = 40;
    const headerHeight = 72;

    function loadImageDataURL(src) {
      return new Promise((resolve) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function () {
          try {
            const canvas = document.createElement('canvas');
            canvas.width = img.naturalWidth;
            canvas.height = img.naturalHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            resolve(canvas.toDataURL('image/png'));
          } catch (e) {
            resolve(null);
          }
        };
        img.onerror = function () {
          resolve(null);
        };
        img.src = src;
      });
    }

    // Helper to sanitize text (remove stray ampersands and excessive whitespace)
    function sanitizeText(s) {
      if (!s && s !== '') return '-';
      try {
        return String(s).replace(/&/g, '').replace(/\s+/g, ' ').trim() || '-';
      } catch (e) {
        return '-';
      }
    }

    // Header background
    doc.setFillColor(244, 180, 26);
    doc.rect(0, 0, pageWidth, headerHeight, 'F');

    // Try to load the logo from the Assets folder and place it on the header
    const logoData = await loadImageDataURL('Assets/dinadrawing-logo.png');
    const logoSize = 48;
    if (logoData) {
      doc.addImage(logoData, 'PNG', margin, 12, logoSize, logoSize);
    }

    // Title centered in the header
    doc.setFontSize(20);
    doc.setTextColor(0, 0, 0);
    doc.setFont('helvetica', 'bold');
    const titleX = margin + (logoData ? logoSize + 12 : 0);
    doc.text('DiNaDrawing Plan Receipt', titleX, 42);

    // Divider under header
    doc.setDrawColor(220);
    doc.setLineWidth(0.8);
    doc.line(margin, headerHeight + 8, pageWidth - margin, headerHeight + 8);

    // Body content
    let y = headerHeight + 36;
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text('Plan Title:', margin, y);
    doc.setFont('helvetica', 'normal');
    doc.text(sanitizeText(title), margin + 90, y);

    y += 22;
    doc.setFont('helvetica', 'bold');
    doc.text('Location:', margin, y);
    doc.setFont('helvetica', 'normal');
    doc.text('-', margin + 90, y);

    y += 20;
    doc.setFont('helvetica', 'bold');
    doc.text('Date:', margin, y);
    doc.setFont('helvetica', 'normal');
    doc.text('-', margin + 90, y);

    y += 20;
    doc.setFont('helvetica', 'bold');
    doc.text('Status:', margin, y);
    doc.setFont('helvetica', 'normal');
    doc.text('-', margin + 90, y);

    y += 36;
    doc.setFontSize(10);
    doc.setTextColor(120);
    doc.text('Thank you for using DiNaDrawing!', margin, y);

    const pdfBlob = doc.output('blob');
    const pdfURL = URL.createObjectURL(pdfBlob);
    window.open(pdfURL, '_blank');
    hidePlanActionModal();
  }

  // Wire up the buttons inside the global action modal
  document.getElementById('actionArchiveBtn').addEventListener('click', () => archivePlan());
  document.getElementById('actionDownloadBtn').addEventListener('click', () => downloadPDF());
  document.getElementById('actionDeleteBtn').addEventListener('click', () => deletePlan());

  // Close action modal when clicking outside, but DO NOT auto-close the confirm modal
  document.addEventListener('click', (e) => {
    const actionModal = document.getElementById('planActionModal');
    if (!actionModal.contains(e.target)) {
      actionModal.classList.add('hidden');
    }
    // Do not close the confirmation modal on outside clicks; require explicit Cancel/Confirm
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.relative')) {
      document.querySelectorAll('.group .absolute.mt-2').forEach(m => m.classList.add('hidden'));
    }
  });
  </script>

      <!-- GOOGLE MAPS INTEGRATION (same as dashboard) -->
    <script>
        // API KEY
        const API_KEY = 'AIzaSyAGsgQDC6nVu9GQ9CYHQ2TTkbcX6qiF3Qc';

        // Catch auth failure
        window.gm_authFailure = function() {
          console.error('Google Maps authentication failure (gm_authFailure). Check API key / referrers / billing.');
          alert('Google Maps authentication failed. See console for details.');
        };

        let map, marker, autocomplete;

        function initMapOnce() {
          const defaultLocation = { lat: 14.5995, lng: 120.9842 };
          const mapEl = document.getElementById("map");
          if (!mapEl) return;

          map = new google.maps.Map(mapEl, { center: defaultLocation, zoom: 12 });
          marker = new google.maps.Marker({ map, position: defaultLocation, draggable: true });

          const input = document.getElementById("eventLocation");
          if (input && google.maps.places) {
            autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.bindTo("bounds", map);
            autocomplete.addListener("place_changed", () => {
              const place = autocomplete.getPlace();
              if (!place.geometry) return;
              map.setCenter(place.geometry.location);
              map.setZoom(15);
              marker.setPosition(place.geometry.location);
            });
          }

          marker.addListener("dragend", () => {
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ location: marker.getPosition() }, (results, status) => {
              if (status === "OK" && results[0]) {
                const inputEl = document.getElementById("eventLocation");
                if (inputEl) inputEl.value = results[0].formatted_address;
              }
            });
          });
        }

        function loadGoogleMaps(apiKey) {
          if (window.google && google.maps) return Promise.resolve();
          return new Promise((resolve, reject) => {
            const existing = document.querySelector('script[data-gm-loader]');
            if (existing) existing.remove();

            const s = document.createElement('script');
            s.setAttribute('data-gm-loader', '1');
            s.src = `https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(apiKey)}&libraries=places`;
            s.async = true;
            s.defer = true;
            s.onload = () => {
              if (window.google && google.maps) resolve();
              else reject(new Error('Google Maps loaded but google.maps is not available.'));
            };
            s.onerror = (e) => reject(new Error('Failed to load Google Maps script: ' + e.message));
            document.head.appendChild(s);
          });
        }

        const openBtn = document.getElementById("openCreateEvent");
        openBtn?.addEventListener("click", () => {
          if (!API_KEY || API_KEY.includes('PUT_YOUR_REAL_API_KEY')) {
            alert('Put your real Google Maps API key into the script (API_KEY).');
            return;
          }

          loadGoogleMaps(API_KEY)
            .then(() => {
              if (!map) initMapOnce();
              setTimeout(() => { 
                if (map) {
                  google.maps.event.trigger(map, 'resize');
                  map.setCenter(marker?.getPosition() || { lat: 14.5995, lng: 120.9842 });
                }
              }, 250);
            })
            .catch(err => {
              console.error('Maps load error:', err);
              alert('Google Maps failed to load. Check console for details.');
            });
        });
      </script>

  <script>
  // CREATE EVENT MODAL
  document.getElementById("openCreateEvent").addEventListener("click", function () {
    document.getElementById("createEventModal").classList.remove("hidden");
  });
  
  // CLOSE BY (X) BUTTON
  document.getElementById("closeCreateEvent").addEventListener("click", function () {
    document.getElementById("createEventModal").classList.add("hidden");
  });
  
  // CLOSE BY CANCEL BUTTON
  document.getElementById("cancelCreateEvent").addEventListener("click", function () {
    document.getElementById("createEventModal").classList.add("hidden");
  });

  // CLOSE BY SAVE AND CONTINUE BUTTON
  document.getElementById("saveCreateEvent").addEventListener("click", function () {
    document.getElementById("createEventModal").classList.add("hidden");
  });
  
  // CLOSE BY CLICKING BACKDROP
  document.getElementById("createEventModal").addEventListener("click", function (e) {
    if (e.target === this) {
      this.classList.add("hidden");
    }
  });
  
  // DESCRIPTION CHAR COUNT
  const desc = document.getElementById("eventDescription");
  const charCount = document.getElementById("charCount");
  
  desc.addEventListener("input", function () {
    charCount.textContent = desc.value.length;
  });

// JOIN EVENT MODAL
document.getElementById("openJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.remove("hidden");
});

// CLOSE BY (X) BUTTON
document.getElementById("closeJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.add("hidden");
});

// CLOSE BY CANCEL BUTTON
document.getElementById("cancelJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.add("hidden");
});

// CLOSE BY JOIN BUTTON
document.getElementById("joinJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.add("hidden");
});

// CLOSE BY CLICKING BACKDROP
document.getElementById("joinEventModal").addEventListener("click", function (e) {
  if (e.target === this) {
    this.classList.add("hidden");
  }
});

  // NOTIFICATION DROPDOWN
  const notificationBtn = document.getElementById("notificationBtn");
  const notificationPanel = document.getElementById("notificationPanel");
  const notificationDot = document.getElementById("notificationDot");
  const clearTop = document.getElementById("clearNotificationsTop");
  const clearBottom = document.getElementById("clearNotificationsBottom");
  const notifList = document.getElementById("notificationList");

  notificationBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    document.getElementById('profileDropdown')?.classList.add('hidden');
    notificationPanel?.classList.toggle("hidden");
    if (!notificationPanel?.classList.contains("hidden")) {
      notificationDot?.classList.add("hidden");
    }
  });
  function clearNotifications(e){
    e?.preventDefault();
    if (notifList) notifList.innerHTML = '<li class="text-center text-gray-500 text-sm py-4">No notifications</li>';
    notificationDot?.classList.add("hidden");
  }
  clearTop?.addEventListener("click", clearNotifications);
  clearBottom?.addEventListener("click", clearNotifications);

  // PROFILE DROPDOWN
  const profileBtn = document.getElementById('profileBtn');
  const profileDropdown = document.getElementById('profileDropdown');
  profileBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    notificationPanel?.classList.add('hidden');
    profileDropdown?.classList.toggle('hidden');
  });
  document.addEventListener('click', (e) => {
    if (!profileBtn?.contains(e.target) && !profileDropdown?.contains(e.target)) {
      profileDropdown?.classList.add('hidden');
    }
    if (!notificationBtn?.contains(e.target) && !notificationPanel?.contains(e.target)) {
      notificationPanel?.classList.add('hidden');
    }
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      profileDropdown?.classList.add('hidden');
      notificationPanel?.classList.add('hidden');
    }
  });
  document.getElementById('logoutProfile')?.addEventListener('click', () => {
    document.getElementById('logoutBtn')?.click();
  });
</script>

<!-- LOGOUT FUNCTION -->
<script type="module">
    import { auth } from './firebase-config.js'; 
    import { signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    document.addEventListener('DOMContentLoaded', function() {
      const logoutSidebar = document.getElementById('logoutBtn');
      const logoutProfile = document.getElementById('logoutProfile');

      function handleLogout() {
        signOut(auth).then(() => {
          console.log('User signed out successfully');
          window.location.href = 'index.html';
        }).catch((error) => {
          console.error('Logout error:', error);
          alert('Logout failed. Please try again.');
        });
      }

      if (logoutSidebar) {
        logoutSidebar.addEventListener('click', handleLogout);
      }
      if (logoutProfile) {
        logoutProfile.addEventListener('click', handleLogout);
      }
    });
  </script>

</body>
</html>