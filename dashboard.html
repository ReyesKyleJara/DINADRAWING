<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | DiNaDrawing</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fffaf2;
      color: #222;
    }
  </style>
  <style>
  .custom-calendar {
  background: #fffaf2;
  border: 2px solid #f4b41a;
  border-radius: 20px;
  padding: 20px;
  width: 100%;
}
  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
  }
  .calendar-day {
    height: 90px;
    background: white;
    border-radius: 12px;
    padding: 6px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.05);
    border: 1px solid #f4b41a50;
    cursor: pointer;
    transition: 0.2s;
  }
  .calendar-day:hover {
    background: #f4b41a20;
  }
  .calendar-day-number {
    font-weight: 600;
    color: #222;
  }
  .event-tag {
    background: #f4b41a;
    color: #222;
    padding: 2px 6px;
    border-radius: 6px;
    font-size: 10px;
    margin-top: 4px;
    display: inline-block;
  }
</style>
</head>
<body class="flex bg-[#fffaf2]">

<!-- SIDEBAR -->
<aside id="sidebar"
class="fixed top-4 left-0 h-[calc(100vh-1rem)] w-64
       bg-[#f4b41a] rounded-tr-3xl
       p-6 shadow
       hidden md:flex md:flex-col md:gap-6">

  <!-- HEADER -->
  <div class="flex items-center gap-2">
    <img src="Assets/dinadrawing-logo.png" alt="Logo" class="w-14">
    <h2 class="text-xl font-bold text-[#222]">DiNaDrawing</h2>
  </div>

  <!-- NAVIGATIONS -->
  <nav>
    <ul class="space-y-5">
      <li><a href="dashboard.html" class="block px-4 py-2 rounded-lg font-medium bg-[#222] text-white hover:bg-[#111] transition">Home</a></li>
      <li><a href="myplans.php" class="block px-4 py-2 rounded-lg font-medium text-[#222] hover:bg-[#222] hover:text-white transition">My Plans</a></li>
      <li><a href="help.html" class="block px-4 py-2 rounded-lg font-medium text-[#222] hover:bg-[#222] hover:text-white transition">Help</a></li>
      <li><a href="settings.html" class="block px-4 py-2 rounded-lg font-medium text-[#222] hover:bg-[#222] hover:text-white transition">Settings</a></li>
    </ul>
  </nav>
</aside>

  <!-- MAIN CONTENT -->
  <main class="ml-0 md:ml-64 flex-1 min-h-screen px-12 py-10 pt-28">

<!-- PAGE TITLE (STICKY HEADER) -->
<div class="flex justify-between items-center border-b-2 border-gray-200 pb-4 mb-6 fixed top-0 md:left-64 left-0 w-[calc(100%-0rem)] md:w-[calc(100%-16rem)] bg-[#fffaf2] z-40 px-12 py-10">

  <div class="flex flex-col">
    <h1 class="text-3xl font-bold">Welcome, Venice!</h1>
    <span class="text-gray-600 text-sm">Your personal event planner assistant.</span>
  </div>

  <div class="flex items-center gap-3">

    <!-- CREATE EVENT -->
    <button id="openCreateEvent"
      class="border border-[#222] bg-white px-4 py-2 rounded-2xl font-medium hover:bg-[#222] hover:text-white transition">
      <span class="hidden md:inline">+ Create Event</span>
      <span class="md:hidden">Create</span>
    </button>

    <!-- JOIN EVENT -->
    <button id="openJoinEvent"
      class="border border-[#222] bg-white px-4 py-2 rounded-2xl font-medium hover:bg-[#222] hover:text-white transition">
      <span class="hidden md:inline">Join Event</span>
      <span class="md:hidden">Join</span>
    </button>

    <!-- TOPBAR RIGHT -->
    <div class="flex items-center gap-4 relative">

  <!-- CREATE EVENT MODAL -->
<div id="createEventModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center hidden z-50 p-4">
  <div class="bg-white rounded-2xl shadow-xl relative w-full max-w-md max-h-[90vh] overflow-y-auto p-6">
    <button id="closeCreateEvent" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl">
      &times;
    </button>

    <!-- HEADER -->
    <h2 class="text-2xl font-bold mb-1">Create Event</h2>
    <p class="text-sm text-gray-500 mb-4">
      Fill in the details to start planning your event.
    </p>

    <!-- EVENT NAME -->
    <label class="block text-sm font-medium mb-1">Event Name <span class="text-gray-400 text-xs">(required)</span> </label>
    <input type="text" id="eventName" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-4" placeholder="Enter event name">

    <!-- DESCRIPTION -->
    <label class="block text-sm font-medium mb-1">Description </label>
    <textarea id="eventDescription" maxlength="200" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-1 resize-none h-20" placeholder="Write a short description..."></textarea>
    <div class="text-right text-xs text-gray-500 mb-4">
      <span id="charCount">0</span>/200
    </div>

    <!-- DATE & TIME -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium mb-1">Date</label>
        <input type="date" id="eventDate" class="w-full border border-gray-300 rounded-lg px-3 py-2">
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Time</label>
        <input type="time" id="eventTime" class="w-full border border-gray-300 rounded-lg px-3 py-2">
      </div>
    </div>

    <!-- LOCATION -->
    <label class="block text-sm font-medium mb-1">Location</label>
    <input id="eventLocation" type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-2" placeholder="Search for a location">
    <div id="map" class="w-full h-60 rounded-lg border border-gray-300 mb-4"></div>

    <p class="text-gray-500 text-xs mb-4 text-justify">
     Only Event Name is required. You can leave Description, Date, Time, and Location blank and create a poll for your attendees to vote on these details.
    </p>

    <!-- BUTTONS -->
    <div class="flex justify-end gap-3 mb-2">
      <button id="cancelCreateEvent" class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100 transition">
        Cancel
      </button>
      <button id="saveCreateEvent" class="bg-[#f4b41a] px-4 py-2 rounded-lg font-medium hover:bg-[#e0a419] transition">
        Save & Continue
      </button>
    </div>

  </div>
</div>


<!-- JOIN EVENT MODAL -->
<div id="joinEventModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-2xl p-6 w-[500px] shadow-xl relative">
    <button id="closeJoinEvent" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-xl">
      &times;
    </button>

    <!-- HEADER -->
    <h2 class="text-2xl font-bold mb-1">Join Event</h2>
    <p class="text-sm text-gray-500 mb-4">
      Enter the event code or link to join.
    </p>

    <!-- INPUT FIELD -->
    <label class="block text-sm font-medium mb-1">Event Code / Link</label>
    <input type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-6" placeholder="Paste code or link here">

    <!-- BUTTONS -->
    <div class="flex justify-end gap-3">
      <button id="cancelJoinEvent" class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100 transition">
        Cancel
      </button>
      <button id="joinJoinEvent" class="bg-[#f4b41a] px-4 py-2 rounded-lg font-medium hover:bg-[#e0a419] transition">
        Join
      </button>
    </div>
  </div>
</div>

<!-- ABOUT US MODAL -->
<div id="aboutUsModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-[60] p-4">
  <div class="bg-white rounded-2xl shadow-xl relative w-full max-w-2xl max-h-[90vh] overflow-y-auto p-8 mx-auto my-10"
       role="dialog" aria-modal="true" aria-labelledby="aboutUsTitle" onclick="event.stopPropagation()">
    <button id="closeAboutUsModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl" aria-label="Close">
      &times;
    </button>

    <h1 id="aboutUsTitle" class="text-3xl font-bold text-[#222] mb-4">About Us</h1>
    <p class="text-gray-700 mb-6 leading-relaxed">
      <span class="font-semibold text-[#f4b41a]">DiNaDrawing</span> is a collaborative planning platform designed to make organizing events and group activities easy, fun, and efficient.
      Whether you're preparing a trip, party, or project, DiNaDrawing helps you stay connected, assign tasks, and track your plans in one place.
    </p>

    <div class="grid md:grid-cols-2 gap-6 mt-8">
      <div class="bg-[#fffaf2] p-6 rounded-xl border border-gray-200 shadow-sm">
        <h2 class="text-xl font-semibold text-[#222] mb-3">Our Mission</h2>
        <p class="text-gray-700 leading-relaxed text-sm">
          To simplify teamwork and planning by creating a space where collaboration feels effortless, ensuring every plan—big or small—gets drawn out perfectly.
        </p>
      </div>
      <div class="bg-[#fffaf2] p-6 rounded-xl border border-gray-200 shadow-sm">
        <h2 class="text-xl font-semibold text-[#222] mb-3">Our Vision</h2>
        <p class="text-gray-700 leading-relaxed text-sm">
          To become the go-to digital planner for creative teams and friend groups around the world, empowering people to turn their ideas into reality.
        </p>
      </div>
    </div>

    <div class="mt-8">
      <h2 class="text-2xl font-bold text-[#222] mb-4">Meet the Team</h2>
      <div class="grid grid-cols-5 gap-4">
        <div class="flex flex-col items-center bg-[#fffaf2] p-4 rounded-xl border border-gray-200 shadow-sm">
          <img src="Assets/Profile Icon/Ken.jpg" alt="Ken" class="w-16 h-16 rounded-full border-2 border-[#f4b41a] shadow mb-2">
          <h3 class="font-semibold text-[#222] text-sm">Ken Mendoza</h3>
          <p class="text-xs text-gray-600">Front-End Dev</p>
        </div>
        <div class="flex flex-col items-center bg-[#fffaf2] p-4 rounded-xl border border-gray-200 shadow-sm">
          <img src="Assets/Profile Icon/Andrea.jpg" alt="Andrea" class="w-16 h-16 rounded-full border-2 border-[#f4b41a] shadow mb-2">
          <h3 class="font-semibold text-[#222] text-sm">Andrea Calilap</h3>
          <p class="text-xs text-gray-600">Front-End Dev</p>
        </div>
        <div class="flex flex-col items-center bg-[#fffaf2] p-4 rounded-xl border border-gray-200 shadow-sm">
          <img src="Assets/Profile Icon/Angel.jpg" alt="Venice" class="w-16 h-16 rounded-full border-2 border-[#f4b41a] shadow mb-2">
          <h3 class="font-semibold text-[#222] text-sm">Angel Retabale</h3>
          <p class="text-xs text-gray-600">Project Manager</p>
        </div>
        <div class="flex flex-col items-center bg-[#fffaf2] p-4 rounded-xl border border-gray-200 shadow-sm">
          <img src="Assets/Profile Icon/Jara.jpg" alt="Kyle" class="w-16 h-16 rounded-full border-2 border-[#f4b41a] shadow mb-2">
          <h3 class="font-semibold text-[#222] text-sm">Kyle Reyes</h3>
          <p class="text-xs text-gray-600">Back-End Dev</p>
        </div>
        <div class="flex flex-col items-center bg-[#fffaf2] p-4 rounded-xl border border-gray-200 shadow-sm">
          <img src="Assets/Profile Icon/Jovan.jpg" alt="Ralf" class="w-16 h-16 rounded-full border-2 border-[#f4b41a] shadow mb-2">
          <h3 class="font-semibold text-[#222] text-sm">Ralf Sanchez</h3>
          <p class="text-xs text-gray-600">Back-End Dev</p>
        </div>
      </div>
    </div>

    <footer class="mt-8 text-center text-gray-500 text-xs border-t border-gray-200 pt-4">
      © 2025 DiNaDrawing. All rights reserved.
    </footer>
  </div>
</div>

       <!-- NOTIFICATIONS -->
      <div>
        <button id="notificationBtn"
          class="relative w-9 h-9 flex items-center justify-center rounded-full bg-white border border-[#222] hover:bg-[#222] hover:text-white transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3c0 .386-.146.735-.395 1.002L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
          <span id="notificationDot"
            class="absolute top-1 right-1 w-2.5 h-2.5 bg-[#f4b41a] rounded-full"></span>
        </button>
      </div>

       <!-- PROFILE -->
  <div class="relative">
    <button id="profileBtn" class="flex items-center gap-2 bg-[#f4b41a]/30 border border-[#222] rounded-full px-3 py-1.5 hover:bg-[#f4b41a]/50 transition">
      <img src="Assets/Profile Icon/profile.png" alt="Profile" class="w-8 h-8 rounded-full border-2 border-[#f4b41a]">
      <span class="font-medium text-[#222] hidden md:inline">Venice</span>
    </button>

    <!-- PROFILE DROPDOWN -->
    <div id="profileDropdown" class="absolute right-0 mt-2 w-60 bg-white shadow-lg rounded-2xl border border-gray-200 hidden z-50">
    <div class="p-4 border-b border-gray-200 text-center bg-[#fffaf2] rounded-t-2xl">
        <img src="Assets/Profile Icon/profile.png" alt="Profile" class="w-12 h-12 mx-auto rounded-full border-2 border-[#f4b41a] mb-2 shadow">
        <h2 class="text-sm font-semibold text-[#222]">Venice</h2>
      </div>
      <div class="py-2">
        <a href="help.html" class="block px-4 py-2 text-sm hover:bg-gray-50">Help</a>
        <button id="aboutUsBtn" type="button" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-50">About Us</button>
        <a href="settings.html" class="block px-4 py-2 text-sm hover:bg-gray-50">Settings</a>
        <button id="logoutProfile" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">Log out</button>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION DROPDOWN -->
  <div id="notificationPanel"
       class="absolute top-full right-0 mt-2 w-[90vw] md:w-60 lg:w-80 max-w-[28rem]
              bg-white shadow-lg rounded-2xl border border-gray-200 hidden z-50">
    <div class="p-4 border-b border-gray-200 flex justify-between items-center">
      <h4 class="font-semibold">Notifications</h4>
      <a href="#" id="clearNotificationsTop" class="text-sm text-[#2563eb] hover:underline">Mark all as read</a>
    </div>
    <ul id="notificationList" class="p-4 space-y-3 max-h-64 overflow-y-auto">
      <li class="flex items-start gap-3 bg-white hover:bg-gray-50 p-2 rounded-lg cursor-pointer">
        <img src="Assets/Profile Icon/profile2.png" onerror="this.src='Assets/profile2.png'" alt="User" class="w-10 h-10 rounded-full border border-gray-200">
        <p class="text-sm"><strong>Kyle</strong> added 'Rice' to Assigned Tasks in <strong>Family Reunion.</strong></p>
      </li>
      <li class="flex items-start gap-3 bg-white hover:bg-gray-50 p-2 rounded-lg cursor-pointer">
        <img src="Assets/Profile Icon/profile4.png" alt="User" class="w-10 h-10 rounded-full border border-gray-200">
        <p class="text-sm"><strong>Ken</strong> voted for <strong>Oct 16</strong> as the final date for <strong>Birthday Trip.</strong></p>
      </li>
      <li class="flex items-start gap-3 bg-white hover:bg-gray-50 p-2 rounded-lg cursor-pointer">
        <img src="Assets/Profile Icon/profile3.png" alt="User" class="w-10 h-10 rounded-full border border-gray-200">
        <p class="text-sm"><strong>Andrea</strong> added 'Japan' to Poll in <strong>Birthday Trip.</strong></p>
      </li>
    </ul>
    <div class="border-t border-gray-200 p-3 text-center">
      <a href="#" id="clearNotificationsBottom" class="text-sm text-[#2563eb] hover:underline">Clear All Notifications</a>
    </div>
  </div>
</div>
  </div>
</div>

    <!-- BANNER -->
    <div class="mt-4">
      <img src="Assets/banner7.png" alt="Banner" class="w-full h-64 object-flex rounded-2xl shadow-md">
    </div>

    <!-- DASHBOARD GRID -->
    <div class="mt-8">
      
<!-- YOUR UPCOMING PLANS -->
<section class="col-span-2 bg-white rounded-2xl shadow p-6 flex flex-col">
  <div class="flex justify-between items-center mb-4">
    <h3 class="font-semibold text-lg">Your Upcoming Plans</h3>
    <div class="flex gap-2">
      <button id="listViewBtn" class="bg-[#f4b41a] text-[#222] text-sm px-4 py-1.5 rounded-lg font-medium">List</button>
      <button id="calendarViewBtn" class="text-gray-600 hover:text-[#222] text-sm px-4 py-1.5 rounded-lg font-medium">Calendar</button>
    </div>
  </div>

  <!-- LIST VIEW -->
  <div id="listView" class="space-y-4">

    <!-- PLAN 1 -->
    <div class="flex items-stretch rounded-2xl overflow-hidden shadow border border-gray-300">
      <div class="bg-white flex flex-col items-center justify-center w-24 py-4 border-r border-gray-200">
        <p class="text-gray-500 text-lg">Oct</p>
        <p class="text-4xl font-bold text-[#222] leading-none">16</p>
      </div>
      <div class="flex-1 bg-[#E5B94A] text-[#222] p-4 flex flex-col justify-between">
        <div>
          <p class="text-xl font-bold leading-tight">Birthday Trip</p>
          <p class="text-sm opacity-90">Japan</p>
        </div>
        <div class="flex justify-end">
          <button class="bg-[#222] text-white text-sm py-1 px-6 rounded-full hover:bg-[#444] transition mt-2">View</button>
        </div>
      </div>
    </div>

    <!-- PLAN 2 -->
    <div class="flex items-stretch rounded-2xl overflow-hidden shadow border border-gray-300">
      <div class="bg-white flex flex-col items-center justify-center w-24 py-4 border-r border-gray-200">
        <p class="text-gray-500 text-lg">Oct</p>
        <p class="text-4xl font-bold text-[#222] leading-none">18</p>
      </div>
      <div class="flex-1 bg-[#0D8A4A] text-[#222] p-4 flex flex-col justify-between">
        <div>
          <p class="text-xl font-bold leading-tight">Family Reunion</p>
          <p class="text-sm opacity-90">Davao City</p>
        </div>
        <div class="flex justify-end">
          <button class="bg-[#222] text-white text-sm py-1 px-6 rounded-full hover:bg-[#444] transition mt-2">View</button>
        </div>
      </div>
    </div>

    <!-- RECENT PLANS -->
    <div class="mt-6 bg-white border border-gray-200 rounded-2xl p-4">
      <h3 class="font-semibold mb-2 text-lg">Recent Plan</h3>
      <ul class="space-y-1 text-sm">
        <li class="flex justify-between border-b border-gray-100 py-1">
          <span>Baguio Trip</span>
          <span class="text-red-500 text-xs">last January 20, 2025</span>
        </li>
        <li class="flex justify-between border-b border-gray-100 py-1">
          <span>Palawan Trip</span>
          <span class="text-red-500 text-xs">last February 14, 2025</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- CALENDAR VIEW -->
  <div id="calendarView" class="hidden">
    <div id="customCalendar" class="custom-calendar w-full">
      <div class="calendar-header">
        <button id="prevMonth" class="px-3 py-1 bg-white border border-[#222] rounded-lg hover:bg-[#222] hover:text-white transition">Prev</button>
        <h2 id="calendarTitle" class="text-xl font-bold text-[#222]"></h2>
        <button id="nextMonth" class="px-3 py-1 bg-white border border-[#222] rounded-lg hover:bg-[#222] hover:text-white transition">Next</button>
      </div>

      <div class="calendar-grid text-center font-semibold text-[#222] mb-3">
        <div>Sun</div><div>Mon</div><div>Tue</div>
        <div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
      </div>

      <div id="calendarDays" class="calendar-grid"></div>
    </div>
  </div>
</section>

<!-- SCRIPTS -->
<script>

  // YOUR UPCOMING PLANS
  const listViewBtn = document.getElementById("listViewBtn");
  const calendarViewBtn = document.getElementById("calendarViewBtn");
  const listView = document.getElementById("listView");
  const calendarView = document.getElementById("calendarView");

  // LIST VIEW
  listViewBtn.addEventListener("click", () => {
    listView.classList.remove("hidden");
    calendarView.classList.add("hidden");
    listViewBtn.classList.add("bg-[#f4b41a]", "text-[#222]");
    calendarViewBtn.classList.remove("bg-[#f4b41a]", "text-[#222]");
    calendarViewBtn.classList.add("text-gray-600");
  });

  // CALENDAR VIEW
  calendarViewBtn.addEventListener("click", () => {
    listView.classList.add("hidden");
    calendarView.classList.remove("hidden");
    calendarViewBtn.classList.add("bg-[#f4b41a]", "text-[#222]");
    listViewBtn.classList.remove("bg-[#f4b41a]", "text-[#222]");
    listViewBtn.classList.add("text-gray-600");
  });

  // CREATE EVENT MODAL
  document.getElementById("openCreateEvent").addEventListener("click", function () {
    document.getElementById("createEventModal").classList.remove("hidden");
  });
  
  // CLOSE BY (X) BUTTON
  document.getElementById("closeCreateEvent").addEventListener("click", function () {
    document.getElementById("createEventModal").classList.add("hidden");
  });
  
  // CLOSE BY CANCEL BUTTON
  document.getElementById("cancelCreateEvent").addEventListener("click", function () {
    document.getElementById("createEventModal").classList.add("hidden");
  });
  
  // SAVE & CONTINUE: create event via backend, then redirect to plan.php?id=NEW_ID
  document.addEventListener('DOMContentLoaded', function() {
    const saveBtn = document.getElementById("saveCreateEvent");
    const createModal = document.getElementById('createEventModal');
    if (!saveBtn) return;
    saveBtn.addEventListener("click", async function () {
      if (window.location.protocol === 'file:') {
        alert('Open this page via http://localhost/DINADRAWING/dashboard.html (start XAMPP Apache).');
        return;
      }
      const btn = this;
      const prevText = btn.textContent;
      const nameEl = document.getElementById('eventName');
      const descEl = document.getElementById('eventDescription');
      const dateEl = document.getElementById('eventDate');
      const timeEl = document.getElementById('eventTime');
      const locEl  = document.getElementById('eventLocation');
      const name = nameEl?.value.trim() || '';
      const description = descEl?.value.trim() || '';
      const date = dateEl?.value || '';
      const time = timeEl?.value || '';
      const location = locEl?.value.trim() || '';
      if (!name) { alert('Event name is required.'); return; }
      const payload = { name, description, date, time, location };
      btn.disabled = true; btn.textContent = 'Saving...';
      try {
        const resp = await fetch('/DINADRAWING/Backend/api/event/create.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const text = await resp.text();
        let json = {};
        try { json = text ? JSON.parse(text) : {}; } catch {}
        if (resp.ok && json.success && json.id) {
          createModal?.classList.add('hidden');
          window.location.href = `/DINADRAWING/plan.php?id=${json.id}`;
        } else {
          alert(json.message || resp.statusText || 'Failed to save event.');
        }
      } catch (err) {
        console.error('Save error', err);
        alert('Network error. Check Console (F12).');
      } finally {
        btn.disabled = false; btn.textContent = prevText;
      }
    });
  });
  
  // CLOSE BY CLICKING BACKDROP
  document.getElementById("createEventModal").addEventListener("click", function (e) {
    if (e.target === this) {
      this.classList.add("hidden");
    }
  });
  
  // DESCRIPTION CHAR COUNT
  const desc = document.getElementById("eventDescription");
  const charCount = document.getElementById("charCount");
  
  desc.addEventListener("input", function () {
    charCount.textContent = desc.value.length;
  });

// JOIN EVENT MODAL
document.getElementById("openJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.remove("hidden");
});

// CLOSE BY (X) BUTTON
document.getElementById("closeJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.add("hidden");
});

// CLOSE BY CANCEL BUTTON
document.getElementById("cancelJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.add("hidden");
});

// CLOSE BY JOIN BUTTON
document.getElementById("joinJoinEvent").addEventListener("click", function () {
  document.getElementById("joinEventModal").classList.add("hidden");
});

// CLOSE BY CLICKING BACKDROP
document.getElementById("joinEventModal").addEventListener("click", function (e) {
  if (e.target === this) {
    this.classList.add("hidden");
  }
});

  // NOTIFICATION DROPDOWN
  const notificationBtn = document.getElementById("notificationBtn");
  const notificationPanel = document.getElementById("notificationPanel");
  const notificationDot = document.getElementById("notificationDot");
  const clearTop = document.getElementById("clearNotificationsTop");
  const clearBottom = document.getElementById("clearNotificationsBottom");
  const notifList = document.getElementById("notificationList");

  notificationBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    document.getElementById('profileDropdown')?.classList.add('hidden');
    notificationPanel?.classList.toggle("hidden");
    if (!notificationPanel?.classList.contains("hidden")) {
      notificationDot?.classList.add("hidden");
    }
  });
  function clearNotifications(e){
    e?.preventDefault();
    if (notifList) notifList.innerHTML = '<li class="text-center text-gray-500 text-sm py-4">No notifications</li>';
    notificationDot?.classList.add("hidden");
  }
  clearTop?.addEventListener("click", clearNotifications);
  clearBottom?.addEventListener("click", clearNotifications);

  // PROFILE DROPDOWN
  const profileBtn = document.getElementById('profileBtn');
  const profileDropdown = document.getElementById('profileDropdown');
  profileBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    notificationPanel?.classList.add('hidden');
    profileDropdown?.classList.toggle('hidden');
  });
  document.addEventListener('click', (e) => {
    if (!profileBtn?.contains(e.target) && !profileDropdown?.contains(e.target)) {
      profileDropdown?.classList.add('hidden');
    }
    if (!notificationBtn?.contains(e.target) && !notificationPanel?.contains(e.target)) {
      notificationPanel?.classList.add('hidden');
    }
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      profileDropdown?.classList.add('hidden');
      notificationPanel?.classList.add('hidden');
    }
  });

  // ABOUT US BUTTON - OPEN MODAL
  const aboutUsBtn = document.getElementById('aboutUsBtn');
  if (aboutUsBtn) {
    aboutUsBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('aboutUsModal').classList.remove('hidden');
      document.getElementById('profileDropdown').classList.add('hidden');
    });
  }

  // CLOSE ABOUT US MODAL
  const closeAboutUsModal = document.getElementById('closeAboutUsModal');
  if (closeAboutUsModal) {
    closeAboutUsModal.addEventListener('click', () => {
      document.getElementById('aboutUsModal').classList.add('hidden');
    });
  }

  // CLOSE ABOUT US MODAL BY CLICKING BACKDROP
  const aboutUsModal = document.getElementById('aboutUsModal');
  if (aboutUsModal) {
    aboutUsModal.addEventListener('click', (e) => {
      if (e.target === aboutUsModal) {
        aboutUsModal.classList.add('hidden');
      }
    });
  }
</script>

<!-- LOGOUT FUNCTION -->
<script type="module">
    import { auth } from './firebase-config.js'; 
    import { signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    document.addEventListener('DOMContentLoaded', function() {
      const logoutSidebar = document.getElementById('logoutBtn');
      const logoutProfile = document.getElementById('logoutProfile');

      function handleLogout() {
        signOut(auth).then(() => {
          console.log('User signed out successfully');
          window.location.href = 'index.html';
        }).catch((error) => {
          console.error('Logout error:', error);
          alert('Logout failed. Please try again.');
        });
      }

      if (logoutSidebar) {
        logoutSidebar.addEventListener('click', handleLogout);
      }
      if (logoutProfile) {
        logoutProfile.addEventListener('click', handleLogout);
      }
    });
  </script>
  
  <!-- GOOGLE MAPS INTEGRATION -->  
<script>
    // API KEY
    const API_KEY = 'AIzaSyAGsgQDC6nVu9GQ9CYHQ2TTkbcX6qiF3Qc';

    // Catch auth failure
    window.gm_authFailure = function() {
      console.error('Google Maps authentication failure (gm_authFailure). Check API key / referrers / billing.');
      alert('Google Maps authentication failed. See console for details.');
    };

    let map, marker, autocomplete;

    function initMapOnce() {
      const defaultLocation = { lat: 14.5995, lng: 120.9842 };
      const mapEl = document.getElementById("map");
      if (!mapEl) return;

      map = new google.maps.Map(mapEl, { center: defaultLocation, zoom: 12 });
      marker = new google.maps.Marker({ map, position: defaultLocation, draggable: true });

      const input = document.getElementById("eventLocation");
      if (input && google.maps.places) {
        autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo("bounds", map);
        autocomplete.addListener("place_changed", () => {
          const place = autocomplete.getPlace();
          if (!place.geometry) return;
          map.setCenter(place.geometry.location);
          map.setZoom(15);
          marker.setPosition(place.geometry.location);
        });
      }

      marker.addListener("dragend", () => {
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ location: marker.getPosition() }, (results, status) => {
          if (status === "OK" && results[0]) {
            const inputEl = document.getElementById("eventLocation");
            if (inputEl) inputEl.value = results[0].formatted_address;
          }
        });
      });
    }

    function loadGoogleMaps(apiKey) {
      if (window.google && google.maps) return Promise.resolve();
      return new Promise((resolve, reject) => {
        const existing = document.querySelector('script[data-gm-loader]');
        if (existing) existing.remove();

        const s = document.createElement('script');
        s.setAttribute('data-gm-loader', '1');
        s.src = `https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(apiKey)}&libraries=places`;
        s.async = true;
        s.defer = true;
        s.onload = () => {
          if (window.google && google.maps) resolve();
          else reject(new Error('Google Maps loaded but google.maps is not available.'));
        };
        s.onerror = (e) => reject(new Error('Failed to load Google Maps script: ' + e.message));
        document.head.appendChild(s);
      });
    }

    const openBtn = document.getElementById("openCreateEvent");
    openBtn?.addEventListener("click", () => {
      if (!API_KEY || API_KEY.includes('PUT_YOUR_REAL_API_KEY')) {
        alert('Put your real Google Maps API key into the dashboard script (API_KEY).');
        return;
      }

      loadGoogleMaps(API_KEY)
        .then(() => {
          if (!map) initMapOnce();
          setTimeout(() => { 
            if (map) {
              google.maps.event.trigger(map, 'resize');
              map.setCenter(marker?.getPosition() || { lat: 14.5995, lng: 120.9842 });
            }
          }, 250);
        })
        .catch(err => {
          console.error('Maps load error:', err);
          alert('Google Maps failed to load. Check console for details.');
        });
    });
  </script>
<script>
  const calendarTitle = document.getElementById('calendarTitle');
  const calendarDays = document.getElementById('calendarDays');

  let currentDate = new Date();
  let events = [
    { date: '2025-10-16', name: 'Birthday Trip' },
    { date: '2025-10-18', name: 'Family Reunion' }
  ];

  function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);

    calendarTitle.innerText = 
      `${firstDay.toLocaleString('default',{month:'long'})} ${year}`;
    
    calendarDays.innerHTML = '';

    for (let i = 0; i < firstDay.getDay(); i++) {
      const emptyCell = document.createElement('div');
      calendarDays.appendChild(emptyCell);
    }

    for (let d = 1; d <= lastDay.getDate(); d++) {
      const dayCell = document.createElement('div');
      dayCell.classList.add('calendar-day');
      dayCell.innerHTML = `<div class='calendar-day-number'>${d}</div>`;

      const dateString = 
        `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      
      const eventFound = events.find(e => e.date === dateString);
      if (eventFound) {
        const tag = document.createElement('div');
        tag.classList.add('event-tag');
        tag.innerText = eventFound.name;
        dayCell.appendChild(tag);
      }

      calendarDays.appendChild(dayCell);
    }
  }

  document.getElementById('prevMonth').addEventListener('click', ()=>{
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  document.getElementById('nextMonth').addEventListener('click', ()=>{
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  renderCalendar();
</script>

  
</body>
</html>